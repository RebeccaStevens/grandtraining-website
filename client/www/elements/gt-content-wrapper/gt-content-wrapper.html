<link rel="import" href="../../bower_components/polymer/polymer.html">

<!-- Iron elements -->
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-flex-layout/classes/iron-flex-layout.html">

<!-- Paper elements -->
<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">

<!-- GT elements -->
<link rel="import" href="../gt-monitor/gt-monitor.html">
<link rel="import" href="../gt-desktop-item/gt-desktop-item.html">
<link rel="import" href="../gt-window/gt-window.html">

<!-- styles -->
<link rel="import" href="../../styles/shared-styles.html">

<dom-module id="gt-content-wrapper">
  <style include="shared-styles"></style>
  <template>
    <!-- Adaptive Breakpoints -->
    <iron-media-query query-matches="{{screenSizeSmall}}" query="(max-width: 768px)"></iron-media-query>
    <iron-media-query query-matches="{{screenSizeLarge}}" query="(min-width: 769px)"></iron-media-query>

    <!-- small screens -->
    <template is="dom-if" if="{{screenSizeSmall}}" restamp on-dom-change="onWrapperChange">
      <paper-drawer-panel id="drawerPanel" force-narrow>
        <!-- Drawer Toolbar -->
        <paper-scroll-header-panel drawer fixed>

          <paper-toolbar id="drawerToolbar">
            <span class="paper-font-title">{{menuHeader}}</span>
          </paper-toolbar>

          <paper-menu class="main-menu" selected="[[route]]" selectable="a"
            attr-for-item-title="data-title" attr-for-selected="data-title">
            <!-- menu items -->
            <template is="dom-repeat" items="{{menuItems}}">
              <a href="{{item.href}}" on-tap="onDrawerMenuItemTap" data-title="{{item.title}}">
                <paper-item>
                  <iron-icon src="{{item.imgsrc}}"></iron-icon>
                  <span>{{item.title}}</span>
                </paper-item>
              </a>
            </template>
          </paper-menu>
        </paper-scroll-header-panel>
        <!-- Main Area -->
        <paper-header-panel main>
          <paper-toolbar>
            <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
            <div>{{header}}</div>
          </paper-toolbar>
          <!-- content -->
          <div><content></content></div>
        </paper-header-panel>
      </paper-drawer-panel>
    </template>

    <!-- large screens -->
    <template is="dom-if" if="{{screenSizeLarge}}" restamp on-dom-change="onWrapperChange">
      <gt-monitor class="no-select">
        <!-- desktop icons -->
        <template is="dom-repeat" items="{{menuItems}}">
          <gt-desktop-item href="{{item.href}}" class="on-desktop">
            <img src="{{item.imgsrc}}">
            <span>{{item.title}}</span>
          </gt-desktop-item>
        </template>
        <gt-window window-title="{{header}}" maximized class="flex">
          <content select=".window-icon"></content>
          <content select=".ribbon-menu"></content>
          <content select=".ribbon-tab"></content>
          <!-- content -->
          <div class="selectable"><content></content></div>
        </gt-window>
      </gt-monitor>
    </template>
  </template>
</dom-module>
<script>
  (function() {
    'use strict';
    class GTContentWrapper {

      beforeRegister() {
        this.is = 'gt-content-wrapper';

        this.properties = {
          menuHeader: {
            type: String,
            value: 'Menu'
          },

          header: {
            type: String,
            value: ''
          },

          route: String
        };
      }

      ready() { }
      attached() { }
      detached() { }
      attributeChanged() { }

      /**
       * When the wrapper is change (small screen -> large screen or vice versa)
       */
      onWrapperChange() {
        this.fire('wrapper-change');
      }

      /**
       * Close drawer after menu item is selected if drawerPanel is narrow
       */
      onDrawerMenuItemTap() {
        let drawerPanel = Polymer.dom(this.root).querySelector('#drawerPanel');
        if (drawerPanel.narrow) {
          drawerPanel.closeDrawer();
        }
      }
    }

    Polymer(GTContentWrapper);
  })();
</script>
